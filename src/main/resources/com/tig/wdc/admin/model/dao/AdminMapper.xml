<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tig.wdc.admin.model.dao.AdminMapper">
	
	<resultMap id="totalDTO" type="TotalDTO">
		<id column="TE_NO" property="userNo"/>
		<result column="TE_ID" property="userId"/>
		<result column="TE_NAME" property="userName"/>
		<result column="TE_ENROLL_DATE" property="enrollDate"/>
		<result column="TYPE" property="userType"/>
		<result column="누적신고"  property="reportedCnt"/>
	</resultMap>
	
	<resultMap id="userDTO" type="TotalDTO">
		<id column="USER_NO" property="userNo"/>
		<result column="USER_ID" property="userId"/>
		<result column="USER_NAME" property="userName"/>
		<result column="USER_ENROLL_DATE" property="enrollDate"/>
		<result column="TYPE" property="userType"/>
		<result column="누적신고"  property="reportedCnt"/>
	</resultMap>
	
	<resultMap type="StudentDTO" id="studentDTO">
		<id column="USER_NO" property="studentnNo"/>
		<result column="USER_ID" property="id"/>
		<result column="TYPE" property="type"/>
		<result column="USER_NAME" property="studentName"/>
		<result column="USER_PHONE" property="phone"/>
		<result column="USER_BIRTH"  property="birth"/>
		<result column="USER_ENROLL_DATE"  property="enrollDate"/>
		<result column="누적신고"  property="reportedCnt"/>
	</resultMap>
		
	<resultMap id="classLsit" type="ClassDTO">
		<id column="CLS_NO" property="classNo"/>
		<result column="CLS_TITLE" property="classTitle"/>
		<result column="TE_NAME" property="teacherName"/>
		<result column="CLS_PRICE" property="classPrice"/>
		<result column="CLS_TYPE" property="classType"/>
		<result column="CLS_STATUS" property="decisionStatus"/>
	</resultMap>
	
	<resultMap id="reportList" type="ReportDTO">
		<id column="REPORT_NO" property="reportNo"/>
		<result column="REPORT_TITLE" property="reportTitle"/>
		<result column="REPORT_TYPE" property="reportType"/>
		<result column="TE_ID" property="reportId"/>
		<result column="REPORT_DATE" property="reportDate"/>
		<result column="PROCS_STATUS" property="reportStatus"/>
	</resultMap>
	
	<!-- 전체문의 -->
	<resultMap id="totalQuestionList" type="QuestionDTO" >
		<id column="Q_NO" property="questionNo"/>
		<result column="유형" property="questionType"/>
		<result column="이름" property="questionName"/>
		<result column="아이디" property="questionId"/>
		<result column="제목" property="questionTitle"/>
		<result column="날짜" property="questionDate"/>
	</resultMap>
	
	<!-- 강사문의 -->
	<resultMap id="teacherQestionList" type="QuestionDTO" >
		<id column="Q_NO" property="questionNo"/>
		<result column="MEMBER_TYPE" property="questionType"/>
		<result column="TE_NAME" property="questionName"/>
		<result column="TE_ID" property="questionId"/>
		<result column="Q_TITLE" property="questionTitle"/>
		<result column="Q_DATE" property="questionDate"/>
	</resultMap>
	
	<!-- 수강생문의 -->
	<resultMap id="studentQuestionList" type="QuestionDTO" >
		<id column="Q_NO" property="questionNo"/>
		<result column="MEMBER_TYPE" property="questionType"/>
		<result column="USER_NAME" property="questionName"/>
		<result column="USER_ID" property="questionId"/>
		<result column="Q_TITLE" property="questionTitle"/>
		<result column="Q_DATE" property="questionDate"/>
	</resultMap>
	
	<!-- 강사문의상세 -->
	<resultMap id="teacherQuestionInfoDetail" type="QuestionDTO">
		<id column="TE_NO" property="questionNo"/>
		<result column="MEMBER_TYPE" property="questionType"/>
		<result column="TE_NAME" property="questionName"/>
		<result column="TE_ID" property="questionId"/>
		<result column="Q_TITLE" property="questionTitle"/>
		<result column="Q_CONTENT" property="questionContent"/>
	</resultMap>
	
	<!-- 수강생문의상세 -->
	
	<resultMap id="teacherDTO" type="TeacherDTO" >
		<id column="TE_NO" property="teNo"/>
		<result column="TE_ID" property="id"/>
		<result column="TE_NAME" property="name"/>
		<result column="TYPE" property="usertype"/>
		<result column="TE_PHONE"  property="phone"/>
		<result column="TE_TYPE"  property="teacherType"/>
		<result column="TE_ENROLL_DATE"  property="enrollDate"/>
		<result column="TE_INTRO"  property="teacherIntro"/>
		<result column="TE_PIC"  property="imgPath"/>
		<result column="누적신고"  property="reportedCnt"/>
	</resultMap>
	
	<!-- 쿠폰 -->
	<resultMap id="couponList" type="CouponDTO">
		<id column="CPN_NO" property="couponNo"/>
		<result column="USER_ID" property="couponType"/>
		<result column="CPN_NAME" property="couponName"/>
		<result column="DIS_AMOUNT" property="discount"/>
		<result column="CPN_ISSUE_DATE" property="issueDate"/>
		<result column="CPN_START" property="startDate"/>
		<result column="CPN_END" property="endDate"/>
		<result column="CPN_USE_YN" property="useStatus"/>
	</resultMap>
	
	<!-- 공지 -->
	<resultMap id="noticeList" type="NoticeDTO">
		<id column="NOTICE_NO" property="noticeNo"/>
		<result column="NOTICE_TYPE" property="noticeType"/>
		<result column="IMPORTANT_YN" property="importantYN"/>
		<result column="NOTICE_TITLE" property="noticeTitle"/>
		<result column="WRITE_DATE" property="writeDate"/>
	</resultMap>
	
	<!-- 정산 미완료 -->
	<resultMap id="calculateLNoList" type="CalculateDTO">
		<id column="CALC_NO" property="calcNo"/>
		<result column="TE_TYPE" property="teType"/>
		<result column="TE_NAME" property="teName"/>
		<result column="TE_ID" property="teId"/>
		<result column="정산날짜" property="calcMonth"/>
		<result column="정산여부" property="calcYN"/>
	</resultMap>
	
	<!-- 정산 완료 -->
	<resultMap id="calculateLYesList" type="CalculateDTO">
		<id column="TE_TYPE" property="teType"/>
		<result column="TE_NAME" property="teName"/>
		<result column="TE_ID" property="teId"/>
		<result column="정산예정달" property="calcMonth"/>
		<result column="정산여부" property="calcYN"/>
	</resultMap>
	
	<resultMap id="reportDetailDTO" type="ReportDetailDTO">
		<id column="REPORT_NO" property="reportNo"/>
		<result column="REPORT_TITLE" property="reportTitle"/>
		<result column="USER_ID" property="reportedId1"/>
		<result column="TE_ID" property="reportedId2"/>
		<result column="USER_NAME" property="reportedNmae1"/>
		<result column="TE_NAME" property="reportedNmae2"/>
		<result column="REPORT_DATE" property="reportDate"/>
		<result column="REPORT_REASON" property="reason"/>
		<result column="REPORT_PIC" property="imgPath"/>
		<result column="PROCS_STATUS" property="reportStatus"/>
		<result column="type" property="type"/>
	</resultMap>
	
		
	<select id="selectTotalUsertList" resultMap="totalDTO">
		SELECT 
		       T.TE_NO
		     , T.TYPE
		     , T.TE_ID
		     , T.TE_NAME
		     , T.TE_ENROLL_DATE
		     , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		  FROM TEACHER_INFO T
		  LEFT JOIN TE_REPORT_HISTORY TH ON (TH.TE_NO = T.TE_NO)
		  LEFT JOIN REPORT R ON (TH.REPORT_NO = R.REPORT_NO)
		 GROUP BY T.TE_NO
		     , T.TYPE
		     , T.TE_ID
		     , T.TE_NAME
		     , T.TE_ENROLL_DATE
		  UNION ALL
		 SELECT 
		        U.USER_NO
		      , U.TYPE
		      , U.USER_ID
		      , U.USER_NAME
		      , U.USER_ENROLL_DATE
		      , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		    FROM USER_INFO U
		  LEFT JOIN USER_REPORT_HISTORY UH ON (UH.USER_NO = U.USER_NO)
		  LEFT JOIN REPORT R ON (UH.REPORT_NO = R.REPORT_NO)
		 GROUP BY U.USER_NO
		      , U.TYPE
		      , U.USER_ID
		      , U.USER_NAME
		      , U.USER_ENROLL_DATE
	</select>
	
	<select id="selectAllClassList" resultMap="classLsit">
		SELECT 
		       C.CLS_NO
		     , C.CLS_TITLE
		     , C.CLS_TYPE
		     , C.CLS_PRICE
		     , C.CLS_STATUS
		     , TI.TE_NAME
		  FROM CLASS C
		  JOIN TEACHER_INFO TI ON (C.TE_NO = TI.TE_NO)
	</select>
	
	<select id="selectAllReportList" resultMap="reportList">
		  SELECT
		       R.REPORT_NO
		     , R.REPORT_TITLE
		     , R.REPORT_TYPE
		     , T.TE_ID
		     , R.REPORT_DATE
		     , R.PROCS_STATUS
		  FROM REPORT R
		  JOIN TEACHER_INFO T ON (R.REPORT_FROM_NO = T.TE_NO)
		 WHERE REPORT_TYPE = '강사'
		 UNION ALL
		   SELECT
		       R.REPORT_NO
		     , R.REPORT_TITLE
		     , R.REPORT_TYPE
		     , T.USER_ID
		     , R.REPORT_DATE
		     , R.PROCS_STATUS
		  FROM REPORT R
		  JOIN USER_INFO T ON (R.REPORT_FROM_NO = T.USER_NO)
		 WHERE REPORT_TYPE = '수강생'
		 ORDER BY REPORT_NO DESC
    </select>
	
	<!-- 전체 문의 -->
	<select id="selectAllQuestionList" resultMap="totalQuestionList">
	    SELECT 
			   A.Q_NO
			 , A.MEMBER_TYPE 유형
			 , C.USER_NAME 이름
			 , C.USER_ID 아이디
			 , A.Q_TITLE 제목
			 , A.Q_DATE 날짜
		  FROM ADMIN_Q A
		  JOIN USER_TO_ADMIN_Q B ON (A.Q_NO = B.Q_NO)
		  JOIN USER_INFO C ON (B.USER_NO = C.USER_NO)
         UNION ALL
        SELECT 
			   A.Q_NO
			 , A.MEMBER_TYPE 유형
			 , C.TE_NAME 이름
			 , C.TE_ID 아이디
			 , A.Q_TITLE 제목
			 , A.Q_DATE 날짜
		  FROM ADMIN_Q A
		  JOIN TE_TO_ADMIN_Q B ON (A.Q_NO = B.Q_NO)
		  JOIN TEACHER_INFO C ON (B.TE_NO = C.TE_NO)
	</select>
	
	<!-- 강사문의 -->
	<select id="selectTeacherQuestionList" resultMap="teacherQestionList">
		SELECT 
			   A.Q_NO
			 , A.MEMBER_TYPE
			 , C.TE_NAME
			 , C.TE_ID
			 , A.Q_TITLE
			 , A.Q_DATE
		  FROM ADMIN_Q A
		  JOIN TE_TO_ADMIN_Q B ON (A.Q_NO = B.Q_NO)
		  JOIN TEACHER_INFO C ON (B.TE_NO = C.TE_NO)
	</select>
	
	<!-- 수강생문의 -->
	<select id="selectStudentQuestionList" resultMap="studentQuestionList">
		SELECT 
			   A.Q_NO
			 , A.MEMBER_TYPE
			 , C.USER_NAME
			 , C.USER_ID
			 , A.Q_TITLE
			 , A.Q_DATE
		  FROM ADMIN_Q A
		  JOIN USER_TO_ADMIN_Q B ON (A.Q_NO = B.Q_NO)
		  JOIN USER_INFO C ON (B.USER_NO = C.USER_NO)
	</select>
	
	<!-- 강사문의상세 -->
	<select id="selectTeacherQuestionInfoDetail" resultMap="teacherQuestionInfoDetail" parameterType="String">
		SELECT 
			   C.TE_NO
			 , A.MEMBER_TYPE
			 , C.TE_NAME
			 , C.TE_ID
			 , A.Q_TITLE
			 , A.Q_CONTENT
		  FROM ADMIN_Q A
		  JOIN TE_TO_ADMIN_Q B ON (A.Q_NO = B.Q_NO)
		  JOIN TEACHER_INFO C ON (B.TE_NO = C.TE_NO)
		 WHERE A.MEMBER_TYPE = 'TEACHER'
	       AND TE_ID = #{id}
	</select>
	
	<!-- 수강생문의상세 -->
	
	<select id="selectOneStudent" resultMap="studentDTO" parameterType="_int">
		SELECT 
		       U.USER_NO
		     , U.USER_ID
		     , U.USER_NAME
		     , U.TYPE
		     , U.USER_PHONE
		     , U.USER_BIRTH
		     , U.USER_ENROLL_DATE
		     , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		  FROM USER_INFO U
		  LEFT JOIN USER_REPORT_HISTORY UH ON (UH.USER_NO = U.USER_NO)
		  LEFT JOIN REPORT R ON (UH.REPORT_NO = R.REPORT_NO)
		 WHERE U.USER_NO = #{no}
		 GROUP BY 
		          U.USER_NO
		        , U.USER_ID
		        , U.USER_NAME
		        , U.TYPE
		        , U.USER_PHONE
		        , U.USER_BIRTH
		        , U.USER_ENROLL_DATE
	</select>
	
	<select id="selectOneTeacher" resultMap="teacherDTO" parameterType="_int">
		SELECT 
		       T.TE_NO
		     , T.TE_ID
		     , T.TE_NAME
		     , T.TYPE
		     , T.TE_PHONE
             , T.TE_TYPE
		     , T.TE_ENROLL_DATE
             , T.TE_INTRO
             , T.TE_PIC
		     , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		  FROM TEACHER_INFO T
		  LEFT JOIN TE_REPORT_HISTORY TH ON (TH.TE_NO = T.TE_NO)
		  LEFT JOIN REPORT R ON (TH.REPORT_NO = R.REPORT_NO)
		 WHERE T.TE_NO = #{no}
		 GROUP BY 
                   T.TE_NO
                 , T.TE_ID
                 , T.TE_NAME
                 , T.TYPE
                 , T.TE_PHONE
                 , T.TE_TYPE
                 , T.TE_ENROLL_DATE
                 , T.TE_INTRO
                 , T.TE_PIC
	</select>
	
	<select id="selectTeacherList" resultMap="totalDTO" >
		SELECT 
		       T.TE_NO
		     , T.TYPE
		     , T.TE_ID
		     , T.TE_NAME
		     , T.TE_ENROLL_DATE
		     , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		  FROM TEACHER_INFO T
		  LEFT JOIN TE_REPORT_HISTORY TH ON (TH.TE_NO = T.TE_NO)
		  LEFT JOIN REPORT R ON (TH.REPORT_NO = R.REPORT_NO)
		 GROUP BY T.TE_NO
		     , T.TYPE
		     , T.TE_ID
		     , T.TE_NAME
		     , T.TE_ENROLL_DATE
	</select>

	<select id="selectStudentList" resultMap="userDTO" >
		 SELECT 
		        U.USER_NO
		      , U.TYPE
		      , U.USER_ID
		      , U.USER_NAME
		      , U.USER_ENROLL_DATE
		      , COUNT(DECODE(R.PROCS_STATUS,'Y',1)) 누적신고
		    FROM USER_INFO U
		  LEFT JOIN USER_REPORT_HISTORY UH ON (UH.USER_NO = U.USER_NO)
		  LEFT JOIN REPORT R ON (UH.REPORT_NO = R.REPORT_NO)
		 GROUP BY U.USER_NO
		      , U.TYPE
		      , U.USER_ID
		      , U.USER_NAME
		      , U.USER_ENROLL_DATE
	</select>      

	<!-- 쿠폰 -->
	<select id="selectAllCouponList" resultMap="couponList">
		SELECT 
			   A.CPN_NO
			 , B.USER_ID
			 , A.CPN_NAME
			 , A.DIS_AMOUNT
			 , A.CPN_ISSUE_DATE
			 , A.CPN_START
			 , A.CPN_END
			 , A.CPN_USE_YN 
		  FROM COUPON A
          JOIN USER_INFO B ON (A.USER_NO = B.USER_NO)
         ORDER BY A.CPN_NO
	</select>
	
	<!-- 공지 -->
	<select id="selectAllNoticeList" resultMap="noticeList">
		SELECT 
			   NOTICE_NO
			 , NOTICE_TYPE
			 , IMPORTANT_YN
			 , NOTICE_TITLE
			 , WRITE_DATE
		  FROM NOTICE
	</select>
	
	<!-- 정산 미완료 -->
	<select id="selectNoCalculateList" resultMap="calculateLNoList">
	    SELECT 
			   C.TE_TYPE
			 , C.TE_NAME
			 , C.TE_ID
             , EXTRACT(month FROM ADD_MONTHS(B.CLS_START_D,1)) AS 정산예정달
			 , A.CALCUL_STATUS AS 정산여부
		  FROM TUITION_MANAGEMENT A
		  JOIN CLASS B ON (A.CLS_NO = B.CLS_NO)
          JOIN TEACHER_INFO C ON (B.TE_NO = C.TE_NO)
         WHERE EXTRACT(month FROM SYSDATE) <![CDATA[ < ]]> EXTRACT(month FROM ADD_MONTHS(B.CLS_START_D,1))
           AND A.TUITION_M_NO IN (SELECT MAX(TUITION_M_NO)
                                    FROM TUITION_MANAGEMENT
                                    GROUP BY CLS_NO)
	</select>
	
	<!-- 정산 완료 -->
	<select id="selectYesCalculateList" resultMap="calculateLYesList">
		SELECT 
			   A.CALC_NO
			 , B.TE_TYPE
			 , B.TE_NAME
			 , B.TE_ID
			 , TO_CHAR(A.CALC_MONTH) 정산날짜
			 , 'Y' AS 정산여부
		  FROM CALCULATE A
		  JOIN TEACHER_INFO B ON (A.TE_NO = B.TE_NO)
         ORDER BY A.CALC_NO
	</select>
	
	<select id="selectStudentReportList" resultMap="reportDetailDTO" parameterType="ReportDetailDTO">
		SELECT
	       REPORT_NO
	     , REPORT_TITLE
	     <if test='type == "U"'>
	     , TE_ID
	     , TE_NAME
	     </if>
	     <if test='type == "T"'>
	     , USER_ID
	     , USER_NAME
	     </if>
	     , TYPE
	     , REPORT_DATE
	     , REPORT_REASON
	     , REPORT_PIC
	     , PROCS_STATUS
	  FROM REPORT R 
	  <if test='type == "T"'>
	  JOIN USER_INFO U ON (R.REPORT_TO_NO = U.USER_NO)
	 WHERE REPORT_TYPE = '강사'
	 </if>
	  <if test='type == "U"'>
	  JOIN TEACHER_INFO U ON (R.REPORT_TO_NO = U.TE_NO)
	 WHERE REPORT_TYPE = '수강생'
	 </if>
	   AND REPORT_NO = #{reportNo}
	</select>
	
	
<!-- 	<select id="selectTeacherReportList" resultMap="reportDetailDTO" parameterType="_int">
		SELECT
	       REPORT_NO
	     , REPORT_TITLE
	     , TE_ID
	     , TYPE
	     , TE_NAME
	     , REPORT_DATE
	     , REPORT_REASON
	     , REPORT_PIC
	     , PROCS_STATUS
	  FROM REPORT R 
	  JOIN TEACHER_INFO U ON (R.REPORT_TO_NO = U.TE_NO)
	 WHERE REPORT_TYPE = '수강생'
	   AND REPORT_NO = #{no}
	</select> -->
	

	
</mapper>